<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024년 교보문고 베스트셀러 리뷰 트랜드</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nanum Gothic', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            color: #333;
            font-size: 20px;
            font-weight: bold;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .chart-container {
            margin: 40px 0;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
        }
        .wordcloud-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .wordcloud {
            flex: 1;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            text-align: center;
        }
        .wordcloud img {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: contain;
            border-radius: 5px;
            transition: transform 0.3s ease;
        }
        .wordcloud img:hover {
            transform: scale(1.02);
        }
        .wordcloud-title {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 24px;
            font-weight: bold;
        }
        .insight-box {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            font-size: 20px;
            line-height: 1.6;
            font-weight: bold;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 40px;
            font-size: 2.8em;
            font-weight: bold;
        }
        h2 {
            color: #34495e;
            margin: 30px 0;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            font-size: 2em;
            font-weight: bold;
        }
        .tab-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            position: sticky;
            top: 0;
            background-color: white;
            padding: 20px 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .tab-button {
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #e9ecef;
            color: #495057;
            transition: all 0.3s ease;
        }
        .tab-button:hover {
            background-color: #007bff;
            color: white;
        }
        .tab-button.active {
            background-color: #007bff;
            color: white;
        }
        .nav-button {
            display: inline-block;
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
            color: white;
            background-color: #007bff;
            border-radius: 5px;
            margin: 20px 0;
            transition: all 0.3s ease;
        }
        .nav-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>2024년 교보문고 베스트셀러 리뷰 트랜드</h1>

        <div class="tab-container">
            <button class="tab-button" onclick="location.href='2024_kyobo_bestseller_review_trend_visualization.html'">도서별 트랜드</button>
            <button class="tab-button" onclick="location.href='2024_kyobo_bestseller_review_trend_visualization_sentiment.html'">감성 트랜드</button>
            <button class="tab-button active">키워드 트랜드</button>
        </div>

        <!-- 감성별 주요 키워드 -->
        <div class="chart-container">
            <h2>감성별 주요 키워드 비교</h2>
            <div class="wordcloud-container">
                <div class="wordcloud">
                    <div class="wordcloud-title">긍정적 리뷰 키워드 (상위 20개 도서)</div>
                    <img src="word_cloud_output/positive_wordcloud.png" alt="긍정적 리뷰 키워드 워드클라우드">
                </div>
                <div class="wordcloud">
                    <div class="wordcloud-title">부정적 리뷰 키워드 (하위 20개 도서)</div>
                    <img src="word_cloud_output/negative_wordcloud.png" alt="부정적 리뷰 키워드 워드클라우드">
                </div>
            </div>
            <div class="insight-box">
                <p>
                    <strong>긍정적 리뷰 키워드 분석:</strong><br>
                    상위 20개 도서의 리뷰에서는 "재미있다", "좋다", "감동적" 등의 키워드가 두드러지게 나타나며,
                    이는 독자들이 도서에서 느끼는 즐거움과 만족감을 직접적으로 표현합니다.
                    특히 "몰입감", "흥미진진", "재미있게" 등의 키워드는 도서의 스토리텔링과 내용 전개가 성공적이었음을 시사합니다.
                </p>
                <p>
                    <strong>부정적 리뷰 키워드 분석:</strong><br>
                    하위 20개 도서의 리뷰에서는 "아쉽다", "어렵다", "지루하다" 등의 키워드가 주로 등장하며,
                    이는 독자들이 도서에서 느끼는 불만족스러운 요소들을 나타냅니다.
                    "기대에 못 미치는", "이해하기 어려운", "복잡한" 등의 키워드는 도서의 접근성과 가독성 측면에서 개선이 필요함을 시사합니다.
                </p>
                <p>
                    <strong>키워드 차이 분석:</strong><br>
                    긍정적 리뷰와 부정적 리뷰의 키워드 차이는 독자들이 도서를 평가할 때 중요하게 생각하는 요소들을 명확히 보여줍니다.
                    긍정적 리뷰에서는 내용의 흥미로움과 감동을 중시하는 반면, 부정적 리뷰에서는 이해의 어려움과 기대 불일치를 주로 언급하고 있습니다.
                    이러한 차이는 도서 출판 및 마케팅 전략 수립에 중요한 인사이트를 제공합니다.
                </p>
            </div>
        </div>
    </div>

    <script>
    async function loadData() {
        try {
            const response = await fetch('../data/kyobo_book_sentiment_analysis.csv');
            if (!response.ok) {
                throw new Error('데이터를 불러올 수 없습니다.');
            }
            const csvText = await response.text();
            const rows = csvText.split('\n').filter(row => row.trim());
            const headers = rows[0].split(',');
            
            const data = rows.slice(1).map(row => {
                const values = row.split(',');
                const obj = {};
                headers.forEach((header, i) => {
                    obj[header] = values[i];
                });
                return obj;
            });

            if (!data.length) {
                throw new Error('데이터가 비어있습니다.');
            }

            document.getElementById('loading').style.display = 'none';
            return data;
        } catch (error) {
            console.error('데이터 로드 오류:', error);
            document.getElementById('loading').textContent = '데이터 로드 중 오류가 발생했습니다. 파일 경로를 확인해주세요.';
            throw error;
        }
    }

    async function createWordCloud(data) {
        try {
            // 감성 점수 기준으로 상위/하위 20개 도서 선정
            const sortedBooks = data.sort((a, b) => parseFloat(b.감성점수) - parseFloat(a.감성점수));
            const top20Books = new Set(sortedBooks.slice(0, 20).map(book => book.도서코드));
            const bottom20Books = new Set(sortedBooks.slice(-20).map(book => book.도서코드));

            // 키워드 빈도수 계산
            const positiveKeywords = {};
            const negativeKeywords = {};

            data.forEach(review => {
                if (!review.키워드) return;
                
                const keywords = review.키워드.split('|').map(k => k.trim());
                const bookCode = review.도서코드;
                
                keywords.forEach(keyword => {
                    if (top20Books.has(bookCode)) {
                        positiveKeywords[keyword] = (positiveKeywords[keyword] || 0) + 1;
                    } else if (bottom20Books.has(bookCode)) {
                        negativeKeywords[keyword] = (negativeKeywords[keyword] || 0) + 1;
                    }
                });
            });

            // 상위 100개 키워드 선택
            const getTop100Keywords = (keywords) => {
                return Object.entries(keywords)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 100)
                    .map(([text, size]) => ({ text, size: Math.log2(size) * 10 + 10 }));
            };

            const positiveWords = getTop100Keywords(positiveKeywords);
            const negativeWords = getTop100Keywords(negativeKeywords);

            // 워드 클라우드 생성
            const width = 500;
            const height = 400;

            // 긍정적 워드 클라우드
            d3.select("#positive-cloud").selectAll("*").remove();
            const positiveCloud = d3.layout.cloud()
                .size([width, height])
                .words(positiveWords)
                .padding(5)
                .rotate(() => 0)
                .font("Impact")
                .fontSize(d => d.size)
                .on("end", words => {
                    d3.select("#positive-cloud")
                        .append("svg")
                        .attr("width", width)
                        .attr("height", height)
                        .append("g")
                        .attr("transform", `translate(${width/2},${height/2})`)
                        .selectAll("text")
                        .data(words)
                        .enter()
                        .append("text")
                        .style("font-size", d => `${d.size}px`)
                        .style("font-family", "Impact")
                        .style("fill", "#2ecc71")
                        .attr("text-anchor", "middle")
                        .attr("transform", d => `translate(${d.x},${d.y})rotate(${d.rotate})`)
                        .text(d => d.text);
                });

            // 부정적 워드 클라우드
            d3.select("#negative-cloud").selectAll("*").remove();
            const negativeCloud = d3.layout.cloud()
                .size([width, height])
                .words(negativeWords)
                .padding(5)
                .rotate(() => 0)
                .font("Impact")
                .fontSize(d => d.size)
                .on("end", words => {
                    d3.select("#negative-cloud")
                        .append("svg")
                        .attr("width", width)
                        .attr("height", height)
                        .append("g")
                        .attr("transform", `translate(${width/2},${height/2})`)
                        .selectAll("text")
                        .data(words)
                        .enter()
                        .append("text")
                        .style("font-size", d => `${d.size}px`)
                        .style("font-family", "Impact")
                        .style("fill", "#e74c3c")
                        .attr("text-anchor", "middle")
                        .attr("transform", d => `translate(${d.x},${d.y})rotate(${d.rotate})`)
                        .text(d => d.text);
                });

            positiveCloud.start();
            negativeCloud.start();

            // 인사이트 업데이트
            const topPositiveBooks = sortedBooks.slice(0, 3).map(book => book.도서제목);
            const topNegativeBooks = sortedBooks.slice(-3).map(book => book.도서제목);
            
            const insightHtml = `
                <h3>키워드 분석 인사이트</h3>
                <p><strong>긍정적 리뷰 상위 도서:</strong> ${topPositiveBooks.join(', ')}</p>
                <p><strong>부정적 리뷰 상위 도서:</strong> ${topNegativeBooks.join(', ')}</p>
                <p><strong>주요 긍정 키워드:</strong> ${positiveWords.slice(0, 5).map(w => w.text).join(', ')}</p>
                <p><strong>주요 부정 키워드:</strong> ${negativeWords.slice(0, 5).map(w => w.text).join(', ')}</p>
            `;
            
            document.getElementById('insights').innerHTML = insightHtml;

        } catch (error) {
            console.error('워드 클라우드 생성 오류:', error);
            document.getElementById('loading').textContent = '워드 클라우드 생성 중 오류가 발생했습니다.';
        }
    }

    // 페이지 로드 시 실행
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            const data = await loadData();
            await createWordCloud(data);
        } catch (error) {
            console.error('초기화 오류:', error);
        }
    });
    </script>
</body>
</html> 